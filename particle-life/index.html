<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Particle Life Simulation</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #000;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: white;
        }

        canvas {
            display: block;
        }

        /* UI Container Styling */
        #ui-container {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 300px;
            background: rgba(20, 20, 20, 0.85);
            border-radius: 8px;
            border: 1px solid #444;
            backdrop-filter: blur(5px);
            user-select: none;
            transition: all 0.3s ease;
            overflow: hidden; /* Ensures content doesn't spill when collapsed */
        }

        /* Header / Toggle Button */
        #ui-header {
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid transparent;
            transition: background 0.2s;
        }

        #ui-header:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        #ui-header h2 {
            margin: 0;
            font-size: 1.1rem;
            pointer-events: none; /* Let clicks pass to header */
        }

        #toggle-icon {
            font-size: 0.8rem;
            color: #aaa;
            transition: transform 0.3s;
        }

        /* Collapsed State */
        #ui-container.collapsed #ui-content {
            display: none;
        }

        #ui-container.collapsed #toggle-icon {
            transform: rotate(-90deg);
        }

        #ui-container:not(.collapsed) #ui-header {
            border-bottom: 1px solid #444;
        }

        /* Content Area */
        #ui-content {
            padding: 15px;
        }

        .control-group {
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        label { font-size: 0.9rem; color: #ccc; }
        span.val { font-family: monospace; color: #00d2ff; }

        input[type="range"] {
            width: 50%;
            cursor: pointer;
        }

        button {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            background: #2a2a2a;
            color: white;
            border: 1px solid #555;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.2s;
        }

        button:hover { background: #444; }
        button.active { background: #005f7a; border-color: #00d2ff; }

        #fps-counter {
            position: absolute;
            top: 10px;
            left: 10px;
            color: #555;
            font-family: monospace;
            pointer-events: none;
        }
    </style>
</head>
<body>

    <div id="fps-counter">FPS: 0</div>
    <canvas id="simCanvas"></canvas>

    <div id="ui-container">
        <!-- Clickable Header -->
        <div id="ui-header">
            <h2>Particle Life Settings</h2>
            <span id="toggle-icon">â–¼</span>
        </div>

        <!-- Collapsible Content -->
        <div id="ui-content">
            <div class="control-group">
                <label>Particles</label>
                <input type="range" id="param-number" min="500" max="3000" step="100" value="1200">
                <span class="val" id="val-number">1200</span>
            </div>

            <div class="control-group">
                <label>Colors (Types)</label>
                <input type="range" id="param-types" min="2" max="6" step="1" value="4">
                <span class="val" id="val-types">4</span>
            </div>

            <div class="control-group">
                <label>Interaction Radius</label>
                <input type="range" id="param-radius" min="10" max="200" value="80">
                <span class="val" id="val-radius">80</span>
            </div>

            <div class="control-group">
                <label>Force Strength</label>
                <input type="range" id="param-force" min="0.1" max="5" step="0.1" value="1.0">
                <span class="val" id="val-force">1.0</span>
            </div>

            <div class="control-group">
                <label>Friction (0-1)</label>
                <input type="range" id="param-friction" min="0.01" max="0.99" step="0.01" value="0.5">
                <span class="val" id="val-friction">0.5</span>
            </div>

            <button id="btn-reset">Randomize Rules & Reset</button>
            <button id="btn-pause">Pause / Play</button>
        </div>
    </div>

<script>
    /**
     * PARTICLE LIFE SIMULATION
     */

    const canvas = document.getElementById('simCanvas');
    const ctx = canvas.getContext('2d', { alpha: false }); 
    const fpsDiv = document.getElementById('fps-counter');

    // UI Logic (Collapse)
    const uiContainer = document.getElementById('ui-container');
    const uiHeader = document.getElementById('ui-header');
    
    uiHeader.addEventListener('click', () => {
        uiContainer.classList.toggle('collapsed');
    });

    // Inputs
    const inputNumber = document.getElementById('param-number');
    const inputTypes = document.getElementById('param-types');
    const inputRadius = document.getElementById('param-radius');
    const inputForce = document.getElementById('param-force');
    const inputFriction = document.getElementById('param-friction');
    const btnReset = document.getElementById('btn-reset');
    const btnPause = document.getElementById('btn-pause');

    // Display Values
    const valNumber = document.getElementById('val-number');
    const valTypes = document.getElementById('val-types');
    const valRadius = document.getElementById('val-radius');
    const valForce = document.getElementById('val-force');
    const valFriction = document.getElementById('val-friction');

    // Simulation State
    let width, height;
    let atoms = [];
    let rules = []; 
    let isPaused = false;
    
    // Configuration
    const config = {
        atomCount: 1200,
        typeCount: 4,
        rMax: 80,         
        forceFactor: 1.0, 
        friction: 0.5,    
        beta: 0.3,       
        dt: 0.02         
    };

    const colorPalette = [
        '#FF3333', '#33FF33', '#3333FF', 
        '#FFFF33', '#33FFFF', '#FF33FF' 
    ];

    function resize() {
        width = window.innerWidth;
        height = window.innerHeight;
        canvas.width = width;
        canvas.height = height;
    }
    window.addEventListener('resize', resize);
    resize();

    // Interaction Function (As per video logic)
    function interact(r, attraction) {
        const beta = config.beta;
        if (r < beta) {
            return (r / beta) - 1; 
        } else if (beta < r && r < 1) {
            return attraction * (1 - Math.abs(2 * r - 1 - beta) / (1 - beta));
        }
        return 0;
    }

    function createAtoms() {
        atoms = [];
        for (let i = 0; i < config.atomCount; i++) {
            atoms.push({
                x: Math.random() * width,
                y: Math.random() * height,
                vx: 0,
                vy: 0,
                color: Math.floor(Math.random() * config.typeCount)
            });
        }
    }

    function createRules() {
        rules = [];
        for (let i = 0; i < config.typeCount; i++) {
            rules[i] = [];
            for (let j = 0; j < config.typeCount; j++) {
                rules[i][j] = (Math.random() * 2) - 1;
            }
        }
    }

    function init() {
        createRules();
        createAtoms();
    }

    // Physics Loop
    function update() {
        if (isPaused) return;

        for (let i = 0; i < atoms.length; i++) {
            let fx = 0;
            let fy = 0;
            const a = atoms[i];

            for (let j = 0; j < atoms.length; j++) {
                if (i === j) continue;
                const b = atoms[j];

                let dx = b.x - a.x;
                let dy = b.y - a.y;

                if (dx > width * 0.5) dx -= width;
                if (dx < -width * 0.5) dx += width;
                if (dy > height * 0.5) dy -= height;
                if (dy < -height * 0.5) dy += height;

                const dist = Math.sqrt(dx*dx + dy*dy);

                if (dist > 0 && dist < config.rMax) {
                    const r = dist / config.rMax;
                    const attraction = rules[a.color][b.color];
                    const f = interact(r, attraction);

                    const force = f * config.forceFactor;
                    fx += (dx / dist) * force;
                    fy += (dy / dist) * force;
                }
            }

            a.vx = (a.vx + fx * config.dt) * Math.pow(config.friction, 0.1); 
            a.vy = (a.vy + fy * config.dt) * Math.pow(config.friction, 0.1);
        }

        for (let i = 0; i < atoms.length; i++) {
            const a = atoms[i];
            a.x += a.vx;
            a.y += a.vy;

            if (a.x < 0) a.x += width;
            if (a.x >= width) a.x -= width;
            if (a.y < 0) a.y += height;
            if (a.y >= height) a.y -= height;
        }
    }

    // Draw Loop
    function draw() {
        ctx.fillStyle = "black";
        ctx.fillRect(0, 0, width, height);

        for (let i = 0; i < atoms.length; i++) {
            const a = atoms[i];
            ctx.fillStyle = colorPalette[a.color];
            ctx.fillRect(a.x, a.y, 2, 2); 
        }
    }

    let lastTime = 0;
    function loop(timestamp) {
        const dt = timestamp - lastTime;
        lastTime = timestamp;
        if(timestamp % 10 < 1) fpsDiv.innerText = `FPS: ${Math.round(1000/dt)}`;

        update();
        draw();
        requestAnimationFrame(loop);
    }

    // --- Events ---

    btnReset.addEventListener('click', () => init());
    btnPause.addEventListener('click', () => {
        isPaused = !isPaused;
        btnPause.classList.toggle('active');
    });

    inputNumber.addEventListener('input', (e) => {
        config.atomCount = parseInt(e.target.value);
        valNumber.innerText = config.atomCount;
        createAtoms(); 
    });

    inputTypes.addEventListener('input', (e) => {
        config.typeCount = parseInt(e.target.value);
        valTypes.innerText = config.typeCount;
        createRules(); 
        createAtoms(); 
    });

    inputRadius.addEventListener('input', (e) => {
        config.rMax = parseInt(e.target.value);
        valRadius.innerText = config.rMax;
    });

    inputForce.addEventListener('input', (e) => {
        config.forceFactor = parseFloat(e.target.value);
        valForce.innerText = config.forceFactor;
    });

    inputFriction.addEventListener('input', (e) => {
        const val = parseFloat(e.target.value);
        config.friction = 1 - val; 
        valFriction.innerText = val;
    });

    // Start
    config.friction = 1 - parseFloat(inputFriction.value);
    init();
    requestAnimationFrame(loop);

</script>
</body>
</html>